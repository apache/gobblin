/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

import javax.tools.ToolProvider


subprojects {
  plugins.withType(JavaPlugin) {
    configurations {

      compile
      dependencies {
        if (!project.name.contains('gobblin-elasticsearch-deps')) {
          compile(externalDependency.hadoopCommon) {
            exclude module: 'servlet-api'
          }
          compile externalDependency.hadoopClientCore
          compile externalDependency.hadoopAnnotations
          if (project.name.equals('gobblin-runtime') || project.name.equals('gobblin-test')) {
            compile externalDependency.hadoopClientCommon
          }
          compile(externalDependency.guava) {
              force = true
          }
      }
          compile(externalDependency.commonsCodec) {
            force = true
          }

        if (!project.name.contains('gobblin-data-management')){
            // Apache Hive 1.2 still uses log4j, specifically WriterAppender that is not bridged in log4j2
            // so we still need this transitive dependency, This can be removed while migrating to Hive 2.x since
            // it has moved to log4j2 already.
          all*.exclude group: 'log4j', module: 'log4j'
        }

        // Required to add JDK's tool jar, which is required to run byteman tests.
        testCompile (files(((URLClassLoader) ToolProvider.getSystemToolClassLoader()).getURLs()))
      }
      all*.exclude group: 'org.apache.calcite', module: 'calcite-avatica' // replaced by org.apache.calcite.avatica:avatica-core

      // To make sure there is no log4j lib to interfere with log4j2 libraries. This is required for log4j2 migration.
      all*.exclude group: 'org.slf4j', module: 'slf4j-log4j12'
      all*.exclude group: 'org.apache.logging.log4j', module: 'log4j-to-slf4j'
      all*.exclude group: 'log4j', module: 'apache-log4j-extras'
    }
  }
}

